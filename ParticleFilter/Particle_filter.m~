function [estimate] = Particle_filter(z)
global S 



% initialize parameters %%%%%%%%%%%%%%%%%%%%%%%%
                                 
Sigma_Q = diag([4 4]);                                % Measurement nosie covariance matrix
Sigma_R = diag([0.00004 0.00004]);                                 % Process noise covariance matrix 
lambda = 0.001;                                       % Outlier threshold




% Initialize equal weights
% Particle filter %%%%%%%%%%%%%%%%%%%%%%%%%%%%

S_bar(1:2,:) = predict(Sigma_R);

S_bar(3,:) = weight(S_bar,z,lambda,Sigma_Q);


estimate = 0;
% Resample
S_bar = systematic_resample(S_bar);

S = S_bar;

end




